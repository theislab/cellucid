<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>cellucid - Interactive Single-Cell Data Visualization</title>

  <!--
    CELLUCID_WEB_BUILD_ID
    --------------------
    This stamp is used by `cellucid-python`'s hosted-asset proxy cache to decide
    whether it should re-download `index.html` and invalidate its cached
    `/assets/*` files.

    TODO(dev): Update this value whenever you deploy changes to the website.
    Recommended: use an ISO timestamp or a git commit hash.
  -->
  <meta name="cellucid-web-build-id" content="2025-12-31T23:59:59Z-theislab-datasets" />

  <!--
    CELLUCID_EXPORTS_BASE_URL
    ------------------------
    The web app's built-in sample datasets (the "local-demo" source) are now
    hosted outside the web app repo, typically in a separate `cellucid-datasets`
    repo/site. This URL must point at an exports root that contains:
      - datasets.json
      - <dataset-id>/dataset_identity.json
      - <dataset-id>/obs_manifest.json
      - ...

    If you host datasets on GitHub Pages (or any host where you can't set CORS),
    Cellucid will automatically fall back to the `cellucid-datasets/bridge.html`
    iframe bridge (expected at `../bridge.html` relative to this base URL).

    TODO(dev): Set this to your datasets hosting URL (GitHub Pages or custom domain).
  -->
  <meta name="cellucid-exports-base-url" content="https://theislab.github.io/cellucid-datasets/exports/" />

	  <!-- Security (dev-phase strict CSP; no inline scripts) -->
	  <!--
	    Note: `connect-src https: wss:` is dev-friendly (allows any HTTPS/WSS). It’s fine for now.
	    If we want this truly strict, we must allowlist the exact endpoints we use (GitHub/GA/worker/etc).
    The `sha256-...` in `script-src` allowlists the inline JSON-LD `<script type="application/ld+json">`
    block below (SEO structured data) without enabling `'unsafe-inline'`. If you change that JSON, the
    hash must be regenerated or the browser will block the block and report a CSP violation.
    TODO (prod): move CSP to an HTTP response header + generate per-environment.
  -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    base-uri 'none';
    object-src 'none';
    script-src 'self' https://www.googletagmanager.com 'sha256-+9zlP/wQVfV23S04wl/L4pHtJlWnuGrS2YNU0z7yjJQ=';
    style-src 'self' 'unsafe-inline';
    img-src 'self' data: https:;
    font-src 'self' data:;
    connect-src 'self' https: wss: blob: http://localhost:* http://127.0.0.1:* ws://localhost:* ws://127.0.0.1:*;
    frame-src 'self' https:;
    worker-src 'self' blob:;
    manifest-src 'self';
  " />

  <!-- SEO Meta Tags -->
  <meta name="description" content="Every cell tells a story. Navigate through millions of them, uncover hidden patterns, and see your data come alive." />
  <meta name="keywords" content="single-cell, scRNA-seq, UMAP, visualization, WebGL, bioinformatics, gene expression, 3D visualization, cell atlas" />
  <meta name="author" content="Kemal Inecik" />
  <meta name="robots" content="index, follow" />
  <link rel="canonical" href="https://www.cellucid.com" />

  <!-- Preconnect to external services for faster initial connection -->
  <link rel="preconnect" href="https://www.googletagmanager.com" />
  <link rel="preconnect" href="https://theislab.github.io" crossorigin />

  <!-- Open Graph / Social Media -->
  <meta property="og:title" content="cellucid - Interactive Single-Cell Data Visualization" />
  <meta property="og:description" content="Every cell tells a story. Navigate through millions of them, uncover hidden patterns, and see your data come alive." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.cellucid.com" />
  <meta property="og:image" content="https://www.cellucid.com/assets/img/og-preview.jpg" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="cellucid - Interactive Single-Cell Data Visualization" />
  <meta name="twitter:description" content="Every cell tells a story. Navigate through millions of them, uncover hidden patterns, and see your data come alive." />
  <meta name="twitter:image" content="https://www.cellucid.com/assets/img/og-preview.jpg" />

	  <!-- Structured Data for Search Engines -->
	  <script type="application/ld+json">{
	    "@context": "https://schema.org",
	    "@type": "WebApplication",
	    "name": "cellucid",
	    "description": "GPU-powered single-cell atlas viewer with real-time filtering, gene expression overlays, vector field animation, and collaborative community annotation.",
	    "url": "https://www.cellucid.com",
	    "image": "https://www.cellucid.com/assets/img/og-preview.jpg",
	    "logo": "https://www.cellucid.com/assets/img/android-chrome-512x512.png",
	    "applicationCategory": "Scientific Software",
	    "operatingSystem": "Any (Web Browser)",
	    "browserRequirements": "Requires WebGL2",
	    "isAccessibleForFree": true,
	    "offers": {
	      "@type": "Offer",
	      "price": "0",
	      "priceCurrency": "USD"
	    },
	    "author": {
	      "@type": "Person",
	      "name": "Kemal Inecik",
	      "url": "https://kemalinecik.com"
	    },
	    "featureList": [
	      "Real-time rendering of millions of cells with adaptive level of detail (LOD)",
	      "Gene expression overlays with efficient sparse matrix handling",
	      "Categorical and continuous cell metadata coloring, filtering, and selection",
	      "Multi-dimensional support (1D timelines, 2D, 3D embeddings)",
	      "Animated vector field overlays (velocity / drift) with GPU particle flow",
	      "KNN connectivity edge visualization",
	      "Publication export: SVG (vector) + PNG (high-DPI)",
	      "Collaborative community annotation voting with optional GitHub sync"
	    ]
	  }</script>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-K4774ZWGEQ"></script>
  <script src="assets/js/app/ui/core/ga-init.js"></script>

  <!-- Favicons -->
  <link rel="icon" type="image/png" sizes="256x256" href="assets/img/favicon-256x256.png" />
  <link rel="icon" type="image/png" sizes="128x128" href="assets/img/favicon-128x128.png" />
  <link rel="icon" type="image/png" sizes="96x96" href="assets/img/favicon-96x96.png" />
  <link rel="icon" type="image/png" sizes="64x64" href="assets/img/favicon-64x64.png" />
  <link rel="icon" type="image/png" sizes="48x48" href="assets/img/favicon-48x48.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="assets/img/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="assets/img/favicon-16x16.png" />
  <link rel="icon" type="image/svg+xml" href="assets/img/favicon.svg" />
  <link rel="icon" type="image/x-icon" href="favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="assets/img/apple-touch-icon.png" />
  <link rel="apple-touch-icon" sizes="167x167" href="assets/img/apple-touch-icon-167x167.png" />
  <link rel="apple-touch-icon" sizes="152x152" href="assets/img/apple-touch-icon-152x152.png" />
  <link rel="apple-touch-icon" sizes="120x120" href="assets/img/apple-touch-icon-120x120.png" />
  <link rel="mask-icon" href="assets/img/safari-pinned-tab.svg" color="#111827" />
  <link rel="manifest" href="site.webmanifest" />
  <meta name="msapplication-config" content="browserconfig.xml" />
  <meta name="msapplication-TileImage" content="assets/img/mstile-150x150.png" />
  <meta name="msapplication-TileColor" content="#111827" />
  <meta name="theme-color" content="#ffffff" />

  <!-- Preload critical fonts to avoid FOUT (Flash of Unstyled Text) -->
  <link rel="preload" as="font" type="font/woff2" href="assets/fonts/inter-latin.woff2" crossorigin>
  <link rel="preload" as="font" type="font/woff2" href="assets/fonts/oswald-latin.woff2" crossorigin>
  <link rel="preload" as="font" type="font/woff2" href="assets/fonts/firacode-latin.woff2" crossorigin>

  <!-- Apply persisted theme early to avoid a flash when loading CSS -->
  <script src="assets/js/app/ui/core/theme-init.js"></script>

  <!-- Fonts are now self-hosted in assets/fonts/ for better performance -->
  <link rel="stylesheet" href="assets/css/main.css" />
</head>
<body>
	  <!-- SEO: Semantic content for search engines and screen readers (hidden visually) -->
	  <main class="sr-only" aria-label="About cellucid">
	    <h1>cellucid - Interactive Single-Cell Data Visualization</h1>
	    <p>GPU-powered atlas viewer for single-cell data with fast rendering, real-time filtering, and collaborative annotation.</p>
	    <h2>Key Features</h2>
	    <ul>
	      <li>Real-time rendering of millions of cells with adaptive level of detail (LOD)</li>
	      <li>Gene expression overlays with efficient sparse matrix handling</li>
	      <li>Categorical and continuous cell metadata coloring, filtering, and selection</li>
	      <li>Multi-dimensional support (1D timelines, 2D, 3D embeddings)</li>
	      <li>Animated vector field overlay (velocity / drift) with GPU particle flow</li>
	      <li>Community annotation voting with optional GitHub sync</li>
	      <li>Connectivity edge visualization (KNN graph)</li>
	      <li>Publication export: SVG (vector) + PNG (high-DPI)</li>
	    </ul>
	    <h2>Data Sources</h2>
	    <p>Load prepared exports, AnnData <code>.h5ad</code> files, or <code>.zarr</code> stores directly in the browser, from a Python server, or from a Jupyter notebook.</p>
	    <h2>Use Cases</h2>
	    <p>Explore scRNA-seq atlases, query marker genes, compare embeddings, visualize trajectories, and build consensus community annotations.</p>
	  </main>

	  <noscript>
	    <div class="noscript-message">
	      <h1>cellucid - Interactive Single-Cell Data Visualization</h1>
	      <p>Cellucid requires JavaScript and WebGL2 to run. Please enable JavaScript in your browser to use this application.</p>
	      <h2>About cellucid</h2>
	      <p>GPU-powered atlas viewer for single-cell data with fast rendering, real-time filtering, and collaborative annotation.</p>
	      <h3>Features</h3>
	      <ul>
	        <li>Real-time rendering of millions of cells with adaptive level of detail (LOD)</li>
	        <li>Gene expression overlays</li>
	        <li>Categorical and continuous cell metadata coloring, filtering, and selection</li>
	        <li>Multi-dimensional support (1D timelines, 2D, 3D embeddings)</li>
	        <li>Animated vector field overlays (velocity / drift)</li>
	        <li>Community annotation voting with optional GitHub sync</li>
	        <li>Connectivity edge visualization (KNN graph)</li>
	        <li>Publication export: SVG (vector) + PNG (high-DPI)</li>
	      </ul>
	      <p>Created by <a href="https://kemalinecik.com">Kemal Inecik</a></p>
	    </div>
	  </noscript>

  <!-- Welcome Modal (shown on first visit, hidden by default) -->
  <div id="welcome-modal" class="welcome-modal hidden" role="dialog" aria-modal="true" aria-labelledby="welcome-title">
    <div class="welcome-backdrop"></div>
    <div class="welcome-content">
      <div class="welcome-header">
        <img src="assets/img/cellucid-logo.svg" alt="cellucid" class="welcome-logo" />
        <h2 id="welcome-title" class="welcome-tagline">Interactive Single-Cell Visualization</h2>
      </div>

      <div class="welcome-body">
        <p class="welcome-intro">Every cell tells a story. Navigate through millions of them, uncover hidden patterns, and see your data come alive.</p>

        <div class="welcome-actions">
          <button type="button" class="welcome-btn welcome-btn-primary" id="welcome-demo-btn">
            <span class="welcome-btn-icon">◈</span>
            <span class="welcome-btn-text">
              <span class="welcome-btn-title">Start Exploring</span>
              <span class="welcome-btn-desc">Dive into the visualization</span>
            </span>
          </button>

          <a href="https://cellucid.readthedocs.io" target="_blank" rel="noopener noreferrer" class="welcome-btn welcome-btn-link">
            <span class="welcome-btn-icon">→</span>
            <span class="welcome-btn-text">
              <span class="welcome-btn-title">Learn More</span>
              <span class="welcome-btn-desc">Guides and documentation</span>
            </span>
          </a>
        </div>

        <div class="welcome-quote">
          <span class="welcome-quote-explanation">On the art of exploration</span>
          <span class="welcome-quote-text">"Not all those who wander are lost."</span>
          <span class="welcome-quote-attr">— <span class="welcome-quote-author">J.R.R. Tolkien</span>, <span class="welcome-quote-book">The Fellowship of the Ring</span></span>
        </div>
      </div>
    </div>
  </div>

  <!-- License Modal -->
  <div id="license-modal" class="license-modal hidden" role="dialog" aria-modal="true" aria-labelledby="license-title">
    <div class="license-backdrop"></div>
    <div class="license-content">
      <div class="license-header">
        <h2 id="license-title">BSD 3-Clause License</h2>
        <button type="button" class="license-close" id="license-close-btn" aria-label="Close">&times;</button>
      </div>
      <div class="license-body">
        <p class="license-copyright">Copyright &copy; 2025 Kemal Inecik</p>
        <p>Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</p>
        <ol>
          <li>Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</li>
          <li>Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</li>
          <li>Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</li>
        </ol>
        <p class="license-disclaimer">THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</p>
      </div>
    </div>
  </div>

  <canvas id="glcanvas" tabindex="0"></canvas>

  <!-- Sidebar toggle button -->
  <button id="sidebar-toggle" class="sidebar-open" title="Toggle sidebar">✕</button>

		  <div id="sidebar">
		    <div id="sidebar-resize-handle" title="Drag to resize"></div>
		    <div class="sidebar-scroll">
		      <div class="sidebar-brand">
		        <a class="sidebar-brand-link" href="https://www.cellucid.com" aria-label="Visit cellucid.com">
		          <img src="assets/img/cellucid-logo.svg" alt="cellucid logo" class="sidebar-logo" />
		        </a>
		      </div>

    <div class="accordion">
      <details class="accordion-section" id="session-section" open>
        <summary>Session</summary>
        <div class="accordion-content">
          <!-- Dataset info display -->
          <div id="dataset-info" class="dataset-info">
            <div class="dataset-info-row">
              <span class="dataset-info-label">Dataset</span>
              <span id="dataset-name" class="dataset-info-value">–</span>
            </div>
            <div class="dataset-info-row">
              <span class="dataset-info-label">Description</span>
              <span id="dataset-description" class="dataset-info-value dataset-info-ellipsis" title="—">—</span>
            </div>
            <div class="dataset-info-row">
              <span class="dataset-info-label">Source</span>
              <span id="dataset-source" class="dataset-info-value">–</span>
            </div>
            <div class="dataset-info-row">
              <span class="dataset-info-label">URL</span>
              <span id="dataset-url" class="dataset-info-value dataset-info-ellipsis" title="—">—</span>
            </div>
            <div class="dataset-info-row">
              <span class="dataset-info-label">Cells</span>
              <span id="dataset-cells" class="dataset-info-value">–</span>
            </div>
            <div class="dataset-info-row">
              <span class="dataset-info-label">Genes</span>
              <span id="dataset-genes" class="dataset-info-value">–</span>
            </div>
            <div class="dataset-info-row">
              <span class="dataset-info-label">Obs fields</span>
              <span id="dataset-obs" class="dataset-info-value">–</span>
            </div>
            <div class="dataset-info-row">
              <span class="dataset-info-label">Connectivity</span>
              <span id="dataset-connectivity" class="dataset-info-value">–</span>
            </div>
          </div>

          <!-- Dataset Selector -->
	          <div class="control-block" data-state-serializer-skip="true">
	            <label for="dataset-select">Sample datasets:</label>
	            <select id="dataset-select" class="obs-select">
	              <option value="" disabled selected>Loading...</option>
	            </select>
	          </div>

          <!-- User directory selector -->
	          <div class="control-block mt-1 relative" id="user-data-block" data-state-serializer-skip="true">
            <label class="d-flex items-center gap-1">
              Local data:
              <span id="user-data-info-btn" class="info-btn">i</span>
            </label>
            <div id="user-data-info-tooltip" class="info-tooltip">
              <div class="info-tooltip-content">
                <div class="info-step">H5AD: Load .h5ad files directly in browser</div>
                <div class="info-step">Zarr: Load .zarr directories directly in browser</div>
                <div class="info-step">Prepared: Load optimized data via <span class="info-cmd">cellucid prepare</span></div>
                <div class="info-step">Docs: <a href="https://cellucid.readthedocs.io" target="_blank" rel="noopener noreferrer" class="info-cmd">cellucid.readthedocs.io</a></div>
              </div>
            </div>
            <div class="user-data-row">
              <button id="user-data-h5ad-btn" class="reset-btn data-btn" title="Load single .h5ad file">H5AD</button>
              <button id="user-data-zarr-btn" class="reset-btn data-btn" title="Load .zarr directory">Zarr</button>
              <button id="user-data-browse-btn" class="reset-btn data-btn" title="Load prepared directory">Prepared</button>
              <!-- Hidden file inputs -->
              <input type="file" id="user-data-file-input" class="file-input-hidden" webkitdirectory directory multiple />
              <input type="file" id="user-data-h5ad-input" class="file-input-hidden" accept=".h5ad" />
              <input type="file" id="user-data-zarr-input" class="file-input-hidden" webkitdirectory directory multiple />
            </div>
          </div>

          <!-- Remote server connection -->
	          <div class="control-block mt-0-5 relative" id="remote-server-block" data-state-serializer-skip="true">
            <label class="d-flex items-center gap-1">
              Remote server:
              <span id="remote-info-btn" class="info-btn">i</span>
            </label>
            <div id="remote-info-tooltip" class="info-tooltip">
              <div class="info-tooltip-content">
                <div class="info-step">Stream data from a local or remote server.</div>
                <div class="info-step">Local: <span class="info-cmd">cellucid serve /path/to/data</span></div>
                <div class="info-step">AnnData: <span class="info-cmd">cellucid serve file.h5ad</span></div>
                <div class="info-step">Remote: <span class="info-cmd">ssh -L 8765:localhost:8765 user@host</span></div>
              </div>
            </div>
            <div class="user-data-row">
              <input type="text" id="remote-server-url" class="user-data-path"
                     placeholder="http://localhost:8765" />
              <button id="remote-connect-btn" class="reset-btn">Connect</button>
            </div>
            <div id="remote-disconnect-container" class="user-data-row mt-1">
              <button id="remote-disconnect-btn" class="reset-btn">Disconnect</button>
            </div>
          </div>

          <!-- GitHub repository data loading -->
	          <div class="control-block mt-0-5 relative" id="github-repo-block" data-state-serializer-skip="true">
            <label class="d-flex items-center gap-1">
              GitHub data:
              <span id="github-info-btn" class="info-btn">i</span>
            </label>
            <div id="github-info-tooltip" class="info-tooltip">
              <div class="info-tooltip-content">
                <div class="info-step">Load prepared data from a public GitHub repository.</div>
                <div class="info-step">Format: <span class="info-cmd">owner/repo/path/to/data</span></div>
              </div>
            </div>
            <div class="user-data-row">
              <input type="text" id="github-repo-url" class="user-data-path"
                     placeholder="owner/repo/path/to/exports" />
              <button id="github-connect-btn" class="reset-btn">Load</button>
            </div>
            <div id="github-disconnect-container" class="user-data-row mt-1">
              <button id="github-disconnect-btn" class="reset-btn">Disconnect</button>
            </div>
          </div>

          <!-- Session state save/load -->
          <div class="control-block mt-0" id="session-state-controls">
            <label>Session state:</label>
            <div class="legend-help">
              Save or load the application state including camera, filters, highlights, and settings.
            </div>
            <div class="control-block d-flex gap-2">
              <button id="save-state-btn" class="reset-btn flex-1">Save State</button>
              <button id="load-state-btn" class="reset-btn flex-1">Load State</button>
            </div>
          </div>
        </div>
      </details>

      <details class="accordion-section" open>
        <summary>Visualization</summary>
        <div class="accordion-content">
          <!-- Theme -->
          <div class="control-block" id="theme-controls">
            <label for="theme-select">Theme:</label>
            <select id="theme-select" class="obs-select">
              <option value="light" selected>Light</option>
              <option value="dark">Dark</option>
            </select>
          </div>

          <!-- Background -->
          <div class="control-block">
            <label for="background-select">Background:</label>
            <select id="background-select">
              <option value="grid" selected>Grid (light)</option>
              <option value="grid-dark">Grid (dark)</option>
              <option value="white">White</option>
              <option value="black">Black</option>
            </select>
          </div>

          <!-- Render mode -->
          <div class="control-block">
            <label for="render-mode">Render mode:</label>
            <select id="render-mode" class="obs-select">
              <option value="points">Points</option>
              <option value="smoke">Volumetric smoke cloud</option>
            </select>
          </div>

          <!-- Depth Perception controls -->
          <div class="control-block" id="depth-controls">
            <label>Depth perception:</label>
            <div class="legend-help">
              Visual cues for 3D depth and spatial awareness.
            </div>
            <div class="control-block">
              <label for="point-size">Point size (log):</label>
              <div class="slider-row">
                <input id="point-size" type="range" min="0" max="100" step="0.5" value="0" />
                <span id="point-size-display" class="slider-value">0.75</span>
              </div>
            </div>

            <div class="control-block">
              <label for="lighting-strength">3D lighting:</label>
              <div class="slider-row">
                <input id="lighting-strength" type="range" min="0" max="100" step="1" value="60" />
                <span id="lighting-strength-display" class="slider-value">60</span>
              </div>
            </div>

            <div class="control-block">
              <label for="fog-density">Atmospheric fog:</label>
              <div class="slider-row">
                <input id="fog-density" type="range" min="0" max="100" step="1" value="50" />
                <span id="fog-density-display" class="slider-value">50</span>
              </div>
            </div>

            <div class="control-block">
              <label for="size-attenuation">Perspective size scaling:</label>
              <div class="slider-row">
                <input id="size-attenuation" type="range" min="0" max="100" step="1" value="80" />
                <span id="size-attenuation-display" class="slider-value">80</span>
              </div>
            </div>
          </div>

          <!-- Renderer Settings -->
          <div class="control-block" id="renderer-controls">
            <div class="control-block mt-0 mb-2">
              <label for="hp-shader-quality">Shader quality:</label>
              <div class="legend-help">Lower quality reduces GPU load for smoother interaction.</div>
              <select id="hp-shader-quality" class="obs-select">
                <option value="full">Full (lighting + fog)</option>
                <option value="light">Light (circular, no lighting)</option>
                <option value="ultralight">Ultra-light (square points)</option>
              </select>
            </div>

            <label>Renderer settings:</label>
            <div class="legend-help">
              Improve performance on large datasets or limited hardware.
            </div>
            <div class="control-block">
              <label class="checkbox-inline">
                <input type="checkbox" id="hp-lod-enabled" />
                Level-of-Detail (LOD)
              </label>
            </div>

            <div class="control-block mt-1 ml-4" id="lod-force-container">
              <label for="hp-lod-force">Force LOD level:</label>
              <div class="slider-row">
                <input id="hp-lod-force" type="range" min="-1" max="17" step="1" value="-1" />
                <span id="hp-lod-force-label" class="slider-value">Auto</span>
              </div>
            </div>

            <div class="control-block">
              <label class="checkbox-inline">
                <input type="checkbox" id="hp-frustum-culling" />
                Frustum culling
              </label>
            </div>
          </div>

          <!-- Volumetric smoke controls -->
          <div class="control-block" id="smoke-controls">
            <label>Volumetric smoke:</label>
            <div class="legend-help">
              Physically-based ray-marched smoke. Knobs auto-scale with grid and noise detail.
            </div>

            <label>Quality & performance:</label>
            <div class="control-block">
              <label for="smoke-grid">Grid density:</label>
              <div class="slider-row">
                <input id="smoke-grid" type="range" min="0" max="100" step="1" value="60" />
                <span id="smoke-grid-display" class="slider-value">256³</span>
              </div>
            </div>
            <div class="control-block">
              <label for="smoke-steps">Ray quality:</label>
              <div class="slider-row">
                <input id="smoke-steps" type="range" min="0" max="100" step="1" value="75" />
                <span id="smoke-steps-display" class="slider-value">High</span>
              </div>
            </div>
            <div class="control-block">
              <label for="cloud-resolution">Render resolution:</label>
              <div class="slider-row">
                <input id="cloud-resolution" type="range" min="0" max="100" step="1" value="15" />
                <span id="cloud-resolution-display" class="slider-value">0.51x</span>
              </div>
            </div>
            <div class="control-block">
              <label for="noise-resolution">Noise detail:</label>
              <div class="slider-row">
                <input id="noise-resolution" type="range" min="0" max="100" step="1" value="58" />
                <span id="noise-resolution-display" class="slider-value">128³</span>
              </div>
            </div>

            <label>Shape & motion:</label>
            <div class="control-block">
              <label for="smoke-density">Cloud density:</label>
              <div class="slider-row">
                <input id="smoke-density" type="range" min="0" max="100" step="1" value="56" />
                <span id="smoke-density-display" class="slider-value">9</span>
              </div>
            </div>
            <div class="control-block">
              <label for="smoke-detail">Fine detail:</label>
              <div class="slider-row">
                <input id="smoke-detail" type="range" min="0" max="100" step="1" value="60" />
                <span id="smoke-detail-display" class="slider-value">3.8</span>
              </div>
            </div>
            <div class="control-block">
              <label for="smoke-warp">Turbulence:</label>
              <div class="slider-row">
                <input id="smoke-warp" type="range" min="0" max="100" step="1" value="10" />
                <span id="smoke-warp-display" class="slider-value">10%</span>
              </div>
            </div>
            <div class="control-block">
              <label for="smoke-speed">Animation speed:</label>
              <div class="slider-row">
                <input id="smoke-speed" type="range" min="0" max="100" step="1" value="40" />
                <span id="smoke-speed-display" class="slider-value">1.00</span>
              </div>
            </div>
            <div class="control-block">
              <label for="smoke-edge">Edge softness:</label>
              <div class="slider-row">
                <input id="smoke-edge" type="range" min="0" max="100" step="1" value="0" />
                <span id="smoke-edge-display" class="slider-value">0.2</span>
              </div>
            </div>

            <label>Lighting:</label>
            <div class="control-block">
              <label for="smoke-absorption">Light absorption:</label>
              <div class="slider-row">
                <input id="smoke-absorption" type="range" min="0" max="100" step="1" value="65" />
                <span id="smoke-absorption-display" class="slider-value">1.5</span>
              </div>
            </div>
            <div class="control-block">
              <label for="smoke-scatter">Light scattering:</label>
              <div class="slider-row">
                <input id="smoke-scatter" type="range" min="0" max="100" step="1" value="0" />
                <span id="smoke-scatter-display" class="slider-value">0.0</span>
              </div>
            </div>
            <div class="control-block">
              <label for="smoke-direct-light">Direct lighting:</label>
              <div class="slider-row">
                <input id="smoke-direct-light" type="range" min="0" max="100" step="1" value="3" />
                <span id="smoke-direct-light-display" class="slider-value">0.04x</span>
              </div>
            </div>

          </div>

          <!-- Point rendering controls (points mode only) -->
          <div id="points-controls" class="visible">
            <!-- KNN Connectivity Section -->
            <div class="control-block" id="connectivity-controls">
              <label>KNN Connectivity:</label>

              <div class="legend-help mb-1-5">
                Shows edges between visible cells only.
              </div>

              <label class="checkbox-inline">
                <input type="checkbox" id="toggle-connectivity" />
                Show connectivity edges
              </label>

              <div id="connectivity-sliders" class="nav-mode-box">
                <div class="control-block">
                  <label for="connectivity-color">Edge color:</label>
                  <input type="color" id="connectivity-color" class="connectivity-color-picker" />
                </div>

                <div class="control-block">
                  <label for="connectivity-alpha">Edge opacity:</label>
                  <div class="slider-row">
                    <input id="connectivity-alpha" type="range" min="1" max="100" step="1" value="60" />
                    <span id="connectivity-alpha-display" class="slider-value">0.60</span>
                  </div>
                </div>

                <div class="control-block">
                  <label for="connectivity-width">Line width:</label>
                  <div class="slider-row">
                    <input id="connectivity-width" type="range" min="1" max="50" step="1" value="10" />
                    <span id="connectivity-width-display" class="slider-value">1.0</span>
                  </div>
                </div>

                <div class="control-block">
                  <label for="connectivity-limit">Max edges:</label>
                  <div class="slider-row">
                    <input id="connectivity-limit" type="range" min="1000" max="1000000" step="1000" value="250000" />
                    <span id="connectivity-limit-display" class="slider-value">250k</span>
                  </div>
                </div>

                <div id="connectivity-info" class="legend-help mt-2 tabular-nums"></div>
              </div>
            </div>

            <!-- Velocity overlay (GPU particle flow) -->
            <div class="control-block mt-1" id="velocity-overlay-controls" style="display: none;">
              <label>Vector Field Overlay:</label>

              <div class="legend-help mb-1-5">
                Animated particle flow from per-cell vector fields (velocity / drift), dimension-specific.
              </div>

              <label class="checkbox-inline">
                <input type="checkbox" id="velocity-overlay-enabled" />
                Show overlay
              </label>

              <div id="velocity-overlay-settings" class="nav-mode-box" style="display: none;">
                <div class="control-block">
                  <label for="velocity-field">Vector field:</label>
                  <select id="velocity-field" class="obs-select"></select>
                </div>

                <div class="control-block">
                  <label for="velocity-density">Particle density:</label>
                  <div class="slider-row">
                    <input id="velocity-density" type="range" min="1" max="500" step="1" value="15" />
                    <span id="velocity-density-display" class="slider-value">15K</span>
                  </div>
                </div>

                <div class="control-block">
                  <label for="velocity-speed">Flow speed:</label>
                  <div class="slider-row">
                    <input id="velocity-speed" type="range" min="5" max="500" step="1" value="300" />
                    <span id="velocity-speed-display" class="slider-value">3.0×</span>
                  </div>
                </div>

                <div class="control-block">
                  <label for="velocity-lifetime">Trail length:</label>
                  <div class="slider-row">
                    <input id="velocity-lifetime" type="range" min="10" max="1500" step="10" value="800" />
                    <span id="velocity-lifetime-display" class="slider-value">8.0s</span>
                  </div>
                </div>

                <div class="control-block">
                  <label for="velocity-size">Particle size:</label>
                  <div class="slider-row">
                    <input id="velocity-size" type="range" min="0.5" max="30" step="0.5" value="1" />
                    <span id="velocity-size-display" class="slider-value">1</span>
                  </div>
                </div>

                <div class="control-block">
                  <label for="velocity-opacity">Opacity:</label>
                  <div class="slider-row">
                    <input id="velocity-opacity" type="range" min="0" max="100" step="1" value="60" />
                    <span id="velocity-opacity-display" class="slider-value">60%</span>
                  </div>
                </div>

                <div class="control-block">
                  <label for="velocity-colormap">Color scheme:</label>
                  <select id="velocity-colormap" class="obs-select">
                    <option value="viridis" selected>Viridis</option>
                    <option value="plasma">Plasma</option>
                    <option value="turbo">Turbo</option>
                    <option value="cividis">Cividis</option>
                    <option value="magma">Magma</option>
                    <option value="coolwarm">Coolwarm</option>
                  </select>
                </div>

                <label class="checkbox-inline">
                  <input type="checkbox" id="velocity-sync-lod" checked />
                  Sync with LOD
                </label>

                <!-- Advanced Visual Settings (collapsible) -->
                <details class="mt-2">
                  <summary class="cursor-pointer">Advanced Visual Settings</summary>
                  <div class="mt-1">

                    <!-- Particle Rendering -->
                    <div class="legend-help mb-1" style="font-weight: 500; opacity: 0.7;">Particle Rendering</div>

                    <div class="control-block">
                      <label for="velocity-intensity">Intensity:</label>
                      <div class="slider-row">
                        <input id="velocity-intensity" type="range" min="0.05" max="1.5" step="0.05" value="0.25" />
                        <span id="velocity-intensity-display" class="slider-value">0.25</span>
                      </div>
                    </div>

                    <div class="control-block">
                      <label for="velocity-glow">Glow amount:</label>
                      <div class="slider-row">
                        <input id="velocity-glow" type="range" min="0" max="1" step="0.05" value="0.3" />
                        <span id="velocity-glow-display" class="slider-value">0.3</span>
                      </div>
                    </div>

                    <div class="control-block">
                      <label for="velocity-comet-stretch">Comet stretch:</label>
                      <div class="slider-row">
                        <input id="velocity-comet-stretch" type="range" min="0" max="2" step="0.05" value="0.6" />
                        <span id="velocity-comet-stretch-display" class="slider-value">0.6</span>
                      </div>
                    </div>

                    <div class="control-block">
                      <label for="velocity-core-sharpness">Core sharpness:</label>
                      <div class="slider-row">
                        <input id="velocity-core-sharpness" type="range" min="0" max="1" step="0.05" value="0.7" />
                        <span id="velocity-core-sharpness-display" class="slider-value">0.7</span>
                      </div>
                    </div>

                    <!-- Trail Settings -->
                    <div class="legend-help mb-1 mt-2" style="font-weight: 500; opacity: 0.7;">Trail Settings</div>

                    <div class="control-block">
                      <label for="velocity-trail-fade">Trail persistence:</label>
                      <div class="slider-row">
                        <input id="velocity-trail-fade" type="range" min="0.9" max="0.995" step="0.005" value="0.925" />
                        <span id="velocity-trail-fade-display" class="slider-value">0.925</span>
                      </div>
                    </div>

                    <div class="control-block">
                      <label for="velocity-chromatic-fade">Chromatic fade:</label>
                      <div class="slider-row">
                        <input id="velocity-chromatic-fade" type="range" min="0" max="1" step="0.05" value="0" />
                        <span id="velocity-chromatic-fade-display" class="slider-value">0</span>
                      </div>
                    </div>

                    <div class="control-block">
                      <label for="velocity-turbulence">Turbulence:</label>
                      <div class="slider-row">
                        <input id="velocity-turbulence" type="range" min="0" max="1" step="0.05" value="0.3" />
                        <span id="velocity-turbulence-display" class="slider-value">0.3</span>
                      </div>
                    </div>

                    <!-- HDR & Bloom -->
                    <div class="legend-help mb-1 mt-2" style="font-weight: 500; opacity: 0.7;">HDR & Bloom</div>

                    <div class="control-block">
                      <label for="velocity-exposure">Exposure:</label>
                      <div class="slider-row">
                        <input id="velocity-exposure" type="range" min="0.1" max="2" step="0.05" value="0.5" />
                        <span id="velocity-exposure-display" class="slider-value">0.5</span>
                      </div>
                    </div>

                    <div class="control-block">
                      <label for="velocity-bloom-strength">Bloom strength:</label>
                      <div class="slider-row">
                        <input id="velocity-bloom-strength" type="range" min="0" max="0.5" step="0.01" value="0.08" />
                        <span id="velocity-bloom-strength-display" class="slider-value">0.08</span>
                      </div>
                    </div>

                    <div class="control-block">
                      <label for="velocity-bloom-threshold">Bloom threshold:</label>
                      <div class="slider-row">
                        <input id="velocity-bloom-threshold" type="range" min="0.1" max="1" step="0.05" value="0.75" />
                        <span id="velocity-bloom-threshold-display" class="slider-value">0.75</span>
                      </div>
                    </div>

                    <div class="control-block">
                      <label for="velocity-anamorphic">Anamorphic ratio:</label>
                      <div class="slider-row">
                        <input id="velocity-anamorphic" type="range" min="1" max="3" step="0.1" value="1.2" />
                        <span id="velocity-anamorphic-display" class="slider-value">1.2</span>
                      </div>
                    </div>

                    <!-- Color Grading -->
                    <div class="legend-help mb-1 mt-2" style="font-weight: 500; opacity: 0.7;">Color Grading</div>

                    <div class="control-block">
                      <label for="velocity-saturation">Saturation:</label>
                      <div class="slider-row">
                        <input id="velocity-saturation" type="range" min="0.5" max="2" step="0.05" value="1.15" />
                        <span id="velocity-saturation-display" class="slider-value">1.15</span>
                      </div>
                    </div>

                    <div class="control-block">
                      <label for="velocity-contrast">Contrast:</label>
                      <div class="slider-row">
                        <input id="velocity-contrast" type="range" min="0.5" max="2" step="0.05" value="1.05" />
                        <span id="velocity-contrast-display" class="slider-value">1.05</span>
                      </div>
                    </div>

                    <div class="control-block">
                      <label for="velocity-highlights">Highlights:</label>
                      <div class="slider-row">
                        <input id="velocity-highlights" type="range" min="0.5" max="1.5" step="0.05" value="0.85" />
                        <span id="velocity-highlights-display" class="slider-value">0.85</span>
                      </div>
                    </div>

                    <div class="control-block">
                      <label for="velocity-shadows">Shadows:</label>
                      <div class="slider-row">
                        <input id="velocity-shadows" type="range" min="0.5" max="1.5" step="0.05" value="1.05" />
                        <span id="velocity-shadows-display" class="slider-value">1.05</span>
                      </div>
                    </div>

                    <!-- Cinematic Effects -->
                    <div class="legend-help mb-1 mt-2" style="font-weight: 500; opacity: 0.7;">Cinematic Effects</div>

                    <div class="control-block">
                      <label for="velocity-vignette">Vignette:</label>
                      <div class="slider-row">
                        <input id="velocity-vignette" type="range" min="0" max="1" step="0.05" value="0" />
                        <span id="velocity-vignette-display" class="slider-value">0</span>
                      </div>
                    </div>

                    <div class="control-block">
                      <label for="velocity-film-grain">Film grain:</label>
                      <div class="slider-row">
                        <input id="velocity-film-grain" type="range" min="0" max="0.1" step="0.002" value="0" />
                        <span id="velocity-film-grain-display" class="slider-value">0</span>
                      </div>
                    </div>

                    <div class="control-block">
                      <label for="velocity-chromatic-aberration">Chromatic aberr.:</label>
                      <div class="slider-row">
                        <input id="velocity-chromatic-aberration" type="range" min="0" max="1" step="0.05" value="0" />
                        <span id="velocity-chromatic-aberration-display" class="slider-value">0</span>
                      </div>
                    </div>

                  </div>
                </details>

                <div id="velocity-overlay-info" class="legend-help mt-2 tabular-nums"></div>
              </div>
            </div>
          </div>

          <!-- Reset Camera -->
          <div class="control-block">
            <button id="reset-camera-btn" class="reset-btn">Reset Camera</button>
          </div>
        </div>
      </details>

      <details class="accordion-section" open>
        <summary>Compare Views</summary>
        <div class="accordion-content">
          <!-- Multiview controls -->
          <div class="control-block" id="split-view-controls">
            <label>Multiview:</label>
            <div class="legend-help">
              Keep snapshots to compare UMAP tweaks. Switch to a single view to edit settings.
            </div>

            <div class="split-view-row">
              <button
                id="split-keep-view-btn"
                class="reset-btn"
                title="Freeze current coloring & filters as a new panel"
              >
                Keep view
              </button>
              <button
                id="camera-lock-btn"
                class="toggle-switch camera-lock-btn"
                type="button"
                aria-pressed="false"
                title="Cameras independent (click to link)"
              >
                Locked Cam
              </button>
            </div>

            <div id="split-view-badges-box" class="split-view-badges-box">
              <div id="split-view-badges-list" class="split-view-badges"></div>
              <div class="split-view-hint legend-help"></div>
              <div class="legend-actions compact split-view-actions">
                <div class="d-flex items-center gap-1-5">
                  <span class="legend-help m-0">Layout:</span>
                  <select id="view-layout-mode" class="obs-select">
                    <option value="grid">Grid compare</option>
                    <option value="single">Edit selected view</option>
                  </select>
                </div>
                <button
                  id="split-clear-btn"
                  class="reset-btn"
                  title="Remove all kept views"
                >
                  Clear
                </button>
              </div>
            </div>
          </div>

          <!-- Dimension Level Selector -->
          <div id="dimension-controls" class="control-block dimension-controls">
            <label for="dimension-select">Dimension:</label>
            <div class="legend-help">
              Switch between embeddings for the current view.
            </div>
            <div class="control-block">
              <select id="dimension-select" class="obs-select">
                <!-- Options are dynamically generated based on available dimensions -->
              </select>
            </div>
          </div>

          <!-- Navigation controls -->
          <div class="control-block" id="navigation-controls">
            <label>Navigation:</label>
            <div class="legend-help">
              Choose orbit for 3D exploration, planar for 2D embeddings, or free-fly for immersive movement.
            </div>
            <div class="control-block">
              <label for="navigation-mode">Mode:</label>
              <select id="navigation-mode" class="obs-select">
                <option value="orbit">Orbit</option>
                <option value="planar">Planar</option>
                <option value="free">Free-fly</option>
              </select>
            </div>
            <div id="orbit-controls" class="nav-mode-box">
              <div class="control-block">
                <label for="orbit-key-speed">Keyboard speed:</label>
                <div class="slider-row">
                  <input id="orbit-key-speed" type="range" min="1" max="100" step="1" value="40" />
                  <span id="orbit-key-speed-display" class="slider-value">0.40x</span>
                </div>
              </div>
              <label class="checkbox-inline">
                <input type="checkbox" id="orbit-reverse" checked />
                Google Earth-style drag
              </label>
              <label class="checkbox-inline">
                <input type="checkbox" id="show-orbit-anchor" checked />
                Show orbit anchor
              </label>
            </div>
            <div id="planar-controls" class="nav-mode-box">
              <div class="control-block">
                <label for="planar-pan-speed">Keyboard speed:</label>
                <div class="slider-row">
                  <input id="planar-pan-speed" type="range" min="1" max="100" step="1" value="100" />
                  <span id="planar-pan-speed-display" class="slider-value">0.0075x</span>
                </div>
              </div>
              <label class="checkbox-inline">
                <input type="checkbox" id="planar-zoom-to-cursor" checked />
                Zoom to cursor (pinch-style)
              </label>
              <label class="checkbox-inline">
                <input type="checkbox" id="planar-invert-axes" />
                Invert axes
              </label>
            </div>
            <div id="freefly-controls" class="nav-mode-box">
              <div class="control-block">
                <label for="look-sensitivity">Look sensitivity:</label>
                <div class="slider-row">
                  <input id="look-sensitivity" type="range" min="1" max="30" step="1" value="5" />
                  <span id="look-sensitivity-display" class="slider-value">0.05x</span>
                </div>
              </div>
              <div class="control-block">
                <label for="move-speed">Move speed:</label>
                <div class="slider-row">
                  <input id="move-speed" type="range" min="1" max="500" step="1" value="100" />
                  <span id="move-speed-display" class="slider-value">1.00 u/s</span>
                </div>
              </div>
              <div class="control-block">
                <label class="checkbox-inline">
                  <input type="checkbox" id="invert-look" />
                  Invert look axes
                </label>
              </div>
              <div class="control-block">
                <label class="checkbox-inline">
                  <input type="checkbox" id="projectiles-enabled" />
                  Projectile shooting
                </label>
              </div>
              <div class="control-block">
                <label class="checkbox-inline">
                  <input type="checkbox" id="pointer-lock" />
                  Capture pointer
                </label>
                <div class="legend-help mt-1-5">
                  Hides the cursor and lets you look without dragging. Press Esc to release.
                </div>
              </div>
            </div>
          </div>
        </div>
      </details>

      <details class="accordion-section" open>
        <summary>Coloring & Filtering</summary>
        <div class="accordion-content">
          <!-- Color by obs -->
          <div class="control-block">
            <div class="field-select">
              <label for="categorical-field">Categorical obs:</label>
              <div class="field-selector-row" id="categorical-field-row">
                <select id="categorical-field" class="obs-select"></select>
                <div class="field-actions" aria-label="Categorical field actions">
                  <button type="button" class="field-action-btn" id="copy-categorical-field" title="Duplicate field" disabled>
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                      <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                    </svg>
                  </button>
                  <button type="button" class="field-action-btn" id="rename-categorical-field" title="Rename field" disabled>
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                      <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                      <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                    </svg>
                  </button>
                  <button type="button" class="field-action-btn field-delete-btn" id="delete-categorical-field" title="Delete field" disabled>
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                      <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                    </svg>
                  </button>
                  <button type="button" class="field-action-btn" id="clear-categorical-field" title="Clear field selection" disabled>
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                      <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                  </button>
                </div>
              </div>
            </div>
            <div class="field-select">
              <label for="continuous-field">Continuous obs:</label>
              <div class="field-selector-row" id="continuous-field-row">
                <select id="continuous-field" class="obs-select"></select>
                <div class="field-actions" aria-label="Continuous field actions">
                  <button type="button" class="field-action-btn" id="copy-continuous-field" title="Duplicate field" disabled>
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                      <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                    </svg>
                  </button>
                  <button type="button" class="field-action-btn" id="rename-continuous-field" title="Rename field" disabled>
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                      <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                      <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                    </svg>
                  </button>
                  <button type="button" class="field-action-btn field-delete-btn" id="delete-continuous-field" title="Delete field" disabled>
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                      <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                    </svg>
                  </button>
                  <button type="button" class="field-action-btn" id="clear-continuous-field" title="Clear field selection" disabled>
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                      <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                  </button>
                </div>
              </div>
            </div>
            <!-- Gene Expression (searchable dropdown with field-style actions) -->
            <div class="field-select" id="gene-expression-container">
              <label for="gene-expression-search">Gene Expression:</label>
              <div class="field-selector-row" id="gene-expression-row">
                <div class="searchable-dropdown">
                  <input
                    type="text"
                    id="gene-expression-search"
                    class="search-input"
                    placeholder="Search genes..."
                    autocomplete="off"
                  />
                  <div id="gene-expression-dropdown" class="dropdown-list"></div>
                </div>
                <div class="field-actions" aria-label="Gene expression actions">
                  <button type="button" class="field-action-btn" id="copy-gene-expression" title="Duplicate gene expression" disabled>
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                      <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                    </svg>
                  </button>
                  <button type="button" class="field-action-btn" id="rename-gene-expression" title="Rename gene" disabled>
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                      <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                      <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                    </svg>
                  </button>
                  <button type="button" class="field-action-btn field-delete-btn" id="delete-gene-expression" title="Delete gene" disabled>
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                      <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                    </svg>
                  </button>
                  <button type="button" class="field-action-btn" id="clear-gene-expression" title="Clear gene selection" disabled>
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                      <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Display Options (dashed box) -->
          <div class="display-options-box" id="display-options-container">
            <label>Display options:</label>

            <!-- Outlier Filter (only shown for categorical fields) -->
            <div class="control-block" id="outlier-filter-container">
              <label for="outlier-filter">Outlier filter (latent space):</label>
              <div class="slider-row">
                <input id="outlier-filter" type="range" min="0" max="100" step="1" value="100" />
                <span id="outlier-filter-display" class="slider-value">100%</span>
              </div>
            </div>

            <!-- Centroid controls (categorical fields only) -->
            <div class="control-block" id="centroid-controls">
              <label class="checkbox-inline">
                <input type="checkbox" id="toggle-centroid-points" />
                Show centroids
              </label>
              <label class="checkbox-inline">
                <input type="checkbox" id="toggle-centroid-labels" />
                Show labels
              </label>
            </div>

            <!-- Legend / category controls -->
            <div id="legend"></div>
          </div>
          <div class="control-block" id="active-filters-container">
            <label>Active filters:</label>
            <div id="filter-count" class="filter-info">Showing all points</div>
            <div id="active-filters" class="filter-info-block">
              <div class="filter-info">No filters active</div>
            </div>
          </div>

          <!-- Deleted fields restore UI (hidden when empty) -->
          <div id="deleted-fields-section" class="deleted-fields-section" hidden></div>
        </div>
      </details>

      <!-- Community Annotation is network/auth-driven and intentionally excluded from session bundles. -->
      <details class="accordion-section" open id="community-annotation-section" data-state-serializer-skip="true">
        <summary>Community Annotation</summary>
        <div class="accordion-content">
          <div id="community-annotation-controls"></div>
        </div>
      </details>

      <details class="accordion-section" open id="highlighted-cells-section">
        <summary>Highlighting</summary>
        <div class="accordion-content">
          <div class="highlight-mode-box">
            <label>Highlight mode:</label>
            <div class="highlight-mode-buttons" role="group" aria-label="Highlight mode selection">
              <button type="button" class="toggle-switch highlight-mode-btn" data-mode="annotation" aria-pressed="true">Annotation based</button>
              <button type="button" class="toggle-switch highlight-mode-btn" data-mode="knn">KNN drag</button>
              <button type="button" class="toggle-switch highlight-mode-btn" data-mode="proximity">Proximity drag</button>
              <button type="button" class="toggle-switch highlight-mode-btn" data-mode="lasso">Lasso</button>
            </div>
            <div id="highlight-mode-description" class="legend-help">
              Alt+click a cell to highlight its group. Alt+drag to select a range.
            </div>
          </div>
          <!-- Page selector tabs -->
          <div id="highlight-pages-container">
            <div id="highlight-pages-tabs">
              <!-- Page tabs will be added here dynamically -->
            </div>
            <button type="button" class="highlight-page-add-btn" id="add-highlight-page" title="Add new page">+</button>
          </div>
          <div id="highlighted-groups" class="highlighted-groups-box">
            <div class="highlighted-groups-header">
              <div id="highlight-count" class="filter-info highlight-count-inline">No cells highlighted</div>
              <button type="button" class="highlight-clear-btn" id="clear-all-highlights">Clear</button>
            </div>
            <div id="highlighted-groups-list">
              <!-- Highlighted group items will be added here dynamically -->
            </div>
          </div>

          <!-- Category builder (TASK 3) -->
          <div id="category-builder-container" data-state-serializer-skip></div>
        </div>
      </details>

      <details class="accordion-section" id="page-analysis-section" open>
        <summary>Analysis</summary>
        <div class="accordion-content">
          <!-- Analysis controls and plot will be rendered here by JavaScript -->
        </div>
      </details>

      <details class="accordion-section" id="figure-export-section" data-state-serializer-skip="true">
        <summary>Figure Export</summary>
        <div class="accordion-content">
          <div id="figure-export-controls"></div>
        </div>
      </details>

      <details class="accordion-section" id="shortcuts-section">
        <summary>Keyboard Shortcuts</summary>
        <div class="accordion-content">
          <div class="shortcuts-list">
            <div class="shortcut-item"><kbd>R</kbd><span>Reset camera</span></div>
            <div class="shortcut-item"><kbd>F</kbd><span>Fullscreen</span></div>
            <div class="shortcut-item"><kbd>H</kbd><span>Toggle sidebar</span></div>
            <div class="shortcut-item"><kbd>1</kbd><kbd>2</kbd><kbd>3</kbd><span>Switch dimension</span></div>
            <div class="shortcut-item"><kbd>O</kbd><kbd>P</kbd><kbd>G</kbd><span>Orbit / Planar / Free-fly</span></div>
            <div class="shortcut-item"><kbd>?</kbd><span>Show shortcuts</span></div>
          </div>
          <div class="shortcuts-list mt-2">
            <div class="shortcut-group-title">Navigation (Orbit / Planar / Free-fly)</div>
            <div class="shortcut-item"><kbd>W</kbd><kbd>A</kbd><kbd>S</kbd><kbd>D</kbd><span>Orbit / pan</span></div>
            <div class="shortcut-item"><kbd>=</kbd><kbd>]</kbd><span>Zoom in</span></div>
            <div class="shortcut-item"><kbd>-</kbd><kbd>[</kbd><span>Zoom out</span></div>
            <div class="shortcut-item"><kbd>Shift</kbd><span>Move faster</span></div>
          </div>
          <div class="shortcuts-list">
            <div class="shortcut-group-title">Free-fly specific</div>
            <div class="shortcut-item"><kbd>Q</kbd><kbd>E</kbd><span>Up / down</span></div>
            <div class="shortcut-item"><kbd>Esc</kbd><span>Exit pointer lock</span></div>
          </div>
          <div class="shortcuts-list mt-2">
            <div class="shortcut-group-title">Highlighting</div>
            <div class="shortcut-item"><kbd>Alt</kbd>+click<span>Highlight group</span></div>
            <div class="shortcut-item"><kbd>Alt</kbd>+drag<span>Area selection</span></div>
            <div class="shortcut-item"><kbd>Shift</kbd>+click<span>Add to selection</span></div>
            <div class="shortcut-item"><kbd>X</kbd><span>Clear highlights</span></div>
          </div>
        </div>
      </details>

      <details class="accordion-section" id="benchmark-section" data-state-serializer-skip="true">
        <summary>Performance Benchmark</summary>
        <div class="accordion-content">
          <div class="legend-help mb-0">
            Test rendering limits with synthetic data
          </div>

          <!-- Quick presets -->
          <div class="control-block">
            <label>Quick test:</label>
            <div class="benchmark-presets">
              <button class="btn-small benchmark-preset" data-count="100000">100K</button>
              <button class="btn-small benchmark-preset" data-count="500000">500K</button>
              <button class="btn-small benchmark-preset" data-count="1000000">1M</button>
              <button class="btn-small benchmark-preset" data-count="5000000">5M</button>
              <button class="btn-small benchmark-preset" data-count="10000000">10M</button>
              <button class="btn-small benchmark-preset" data-count="20000000">20M</button>
            </div>
          </div>

          <!-- Custom count -->
          <div class="control-block mt-2">
            <label for="benchmark-count">Custom point count:</label>
            <input type="number" id="benchmark-count" value="1000000" min="1000" max="50000000" step="100000" class="obs-select benchmark-count-input" />
          </div>

          <!-- Pattern selection -->
          <div class="control-block mt-2">
            <label for="benchmark-pattern">Data pattern:</label>
            <select id="benchmark-pattern" class="obs-select">
              <option value="glb" selected>Model Surface</option>
              <option value="atlas">Atlas-like</option>
              <option value="batches">Batch Effects</option>
              <option value="clusters">Gaussian Clusters</option>
              <option value="uniform">Uniform Random</option>
              <option value="octopus">Octopus</option>
              <option value="spirals">3D Spirals</option>
              <option value="flatumap">Flat UMAP</option>
            </select>
          </div>

          <!-- Run button -->
          <div class="control-block mt-2-5">
            <button id="benchmark-run" class="btn-small benchmark-run-btn">
              Load Synthetic Data
            </button>
          </div>

          <!-- Stats display -->
          <div id="benchmark-stats" class="benchmark-stats">
            <div class="benchmark-stats-grid">
              <div class="benchmark-stat">
                <div class="benchmark-stat-label">Points</div>
                <div id="bench-points" class="benchmark-stat-value benchmark-stat-value--headline">-</div>
              </div>
              <div class="benchmark-stat">
                <div class="benchmark-stat-label">FPS</div>
                <div id="bench-fps" class="benchmark-stat-value benchmark-stat-value--headline">-</div>
              </div>
              <div class="benchmark-stat">
                <div class="benchmark-stat-label">Frame Time</div>
                <div id="bench-frametime" class="benchmark-stat-value">-</div>
              </div>
              <div class="benchmark-stat">
                <div class="benchmark-stat-label">GPU Memory</div>
                <div id="bench-memory" class="benchmark-stat-value">-</div>
              </div>
              <div class="benchmark-stat">
                <div class="benchmark-stat-label">LOD Level</div>
                <div id="bench-lod" class="benchmark-stat-value">-</div>
              </div>
              <div class="benchmark-stat">
                <div class="benchmark-stat-label">Visible Points</div>
                <div id="bench-visible" class="benchmark-stat-value">-</div>
              </div>
            </div>
            <!-- Detailed timing stats -->
            <div id="bench-timing-details" class="benchmark-timing-details">
              <div class="benchmark-stat-label mb-1">Timing Details</div>
              <div class="benchmark-timing-grid">
                <div><span class="text-tertiary">min:</span> <span id="bench-min-ft">-</span></div>
                <div><span class="text-tertiary">p95:</span> <span id="bench-p95-ft">-</span></div>
                <div><span class="text-tertiary">max:</span> <span id="bench-max-ft">-</span></div>
              </div>
            </div>
            <!-- Data generation info -->
            <div id="bench-gen-info" class="benchmark-gen-info">
              Generated in <span id="bench-gen-time">-</span>ms
            </div>
          </div>

          <div class="control-block mt-2-5">
            <button id="benchmark-report-btn" class="btn-small benchmark-run-btn">
              Copy Situation Report
            </button>
            <textarea id="benchmark-report-output" readonly></textarea>
          </div>

          <!-- Bottleneck Analysis Section -->
          <div class="bottleneck-section">
            <div class="bottleneck-title">Why is it slow?</div>

            <!-- Single Analysis Button -->
            <div class="control-block">
              <button id="bottleneck-analyze-btn" class="btn-small bottleneck-analyze-btn">
                Analyze Performance
              </button>
            </div>

            <!-- Analysis Progress -->
            <div id="bottleneck-progress" class="bottleneck-progress">
              <div class="d-flex items-center gap-2">
                <span class="bottleneck-spinner" aria-hidden="true"></span>
                <span id="bottleneck-progress-text">Measuring performance...</span>
              </div>
            </div>

            <!-- Analysis Results Panel -->
            <div id="bottleneck-results" class="bottleneck-results">

              <!-- Verdict Box -->
              <div id="bn-verdict-box" class="bn-verdict" data-status="warning">
                <div class="bn-verdict-header">
                  <span id="bn-verdict-icon" class="bn-verdict-icon">⚠️</span>
                  <span id="bn-verdict-title" class="bn-verdict-title">--</span>
                </div>
                <div id="bn-verdict-detail" class="bn-verdict-detail">--</div>
              </div>

              <!-- Current Performance -->
              <div class="bn-fps-row">
                <span class="bn-fps-label">Current FPS</span>
                <div class="bn-fps-value-row">
                  <span id="bn-fps" class="bn-fps-value">--</span>
                  <span class="bn-fps-suffix">/ 60</span>
                </div>
              </div>

              <!-- Problem List -->
              <div id="bn-problems" class="bn-section">
                <div class="bn-section-title">Problems Found:</div>
                <div id="bn-problem-list" class="bn-list"></div>
              </div>

              <!-- What To Do -->
              <div id="bn-fixes" class="bn-section bn-section--success">
                <div class="bn-section-title">What to do:</div>
                <div id="bn-fix-list" class="bn-list"></div>
              </div>

              <!-- Stats (collapsed by default) -->
              <details class="bn-details">
                <summary class="bn-details-summary">Show detailed stats</summary>
                <div class="bn-details-body">
                  <div class="bn-details-grid">
                    <div>Points: <span id="bn-visible-points" class="bn-details-value">--</span></div>
                    <div>GPU Mem: <span id="bn-gpu-memory" class="bn-details-value">--</span></div>
                    <div>LOD: <span id="bn-lod-level" class="bn-details-value">--</span></div>
                    <div>Draw Calls: <span id="bn-draw-calls" class="bn-details-value">--</span></div>
                    <div>Frame Time: <span id="bn-frametime" class="bn-details-value">--</span></div>
                    <div>P95: <span id="bn-p95" class="bn-details-value">--</span></div>
                  </div>
                  <div class="bn-details-section">
                    <div>LOD overhead: <span id="bn-lod-overhead" class="bn-details-value">--</span></div>
                    <div>Frustum overhead: <span id="bn-frustum-overhead" class="bn-details-value">--</span></div>
                    <div>Shader overhead: <span id="bn-shader-overhead" class="bn-details-value">--</span></div>
                  </div>
                  <div class="bn-details-section">
                    <div>Frame stability: <span id="bn-frame-stability" class="bn-details-value">--</span></div>
                    <div>Janky frames: <span id="bn-jank-percent" class="bn-details-value">--</span></div>
                    <div>CPU health: <span id="bn-cpu-health" class="bn-details-value">--</span></div>
                  </div>
                </div>
              </details>
            </div>
          </div>

          <div class="legend-help mt-2">
            <strong>Tips:</strong> Adjust renderer settings in Visualization section.
            Reload page to restore original data.
          </div>
        </div>
      </details>
    </div>

    <div id="stats" class="sr-only">Loading data…</div>

      <div id="copyright">© Kemal Inecik · <a href="https://kemalinecik.com" target="_blank" rel="noopener noreferrer">kemalinecik.com</a> · <a href="#" id="license-link">BSD 3-Clause</a></div>
		  </div>
	  </div>

  <!-- HTML layer for centroid labels -->
  <div id="label-layer"></div>
  <!-- Titles for small multiple viewports -->
  <div id="view-title-layer"></div>

  <!-- glMatrix for matrix math (self-hosted, defer ensures it loads before ES modules) -->
  <script defer src="assets/external/gl-matrix-min.js"></script>
  <!-- Plotly.js is lazy-loaded by the analysis module when needed -->
  <script type="module" src="assets/js/app/main.js"></script>

  <!-- License modal handler -->
  <script defer src="assets/js/app/ui/core/license-modal.js"></script>
</body>
</html>
